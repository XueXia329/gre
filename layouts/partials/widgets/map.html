<!-- Leaflet (JS/CSS) -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"
      integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
      crossorigin=""/>
<script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"
        integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew=="
        crossorigin=""></script>
<script src="{{ .Site.BaseURL }}leaflet-tilelayer-colorfilter.min.js"></script>
<div class="widget-taglist widget">
  <h4 class="widget__title">Map</h4>
  <div class="widget__content">
    <div id='map' class="leaflet-map"></div>
    <script>
      //Create Map
      map = L.map('map', {
        attributionControl: true
      }).setView([40, 17], 3);
      map.attributionControl.setPrefix('Basemaps ');

      // OpenStreetMap, muted colors, for low zoom values
      L.tileLayer.colorFilter('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        minZoom: 0,
        maxZoom: 3,
        attribution: '<a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',
        filter: [
          'brightness: 100%',
          'contrast: 100%',
          'saturation: 30%',
          'opacity: 100%',
          'sepia: 10%'
        ]
      }).addTo(map);

      // Digital Atlas of the Roman Empire, muted colors
      L.tileLayer.colorFilter('https://dh.gu.se/tiles/imperium/{z}/{x}/{y}.png', {
        minZoom: 4,
        maxZoom: 11,
        attribution: '<a href="https://dh.gu.se/dare/">DARE</a>',
        filter: [
          'brightness: 100%',
          'contrast: 100%',
          'saturation: 30%',
          'opacity: 100%',
          'sepia: 10%'
        ]
      }).addTo(map);

      // OpenStreetMap, muted colors, for high zoom values
      L.tileLayer.colorFilter('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        minZoom: 12,
        maxZoom: 18,
        attribution: '<a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',
        filter: [
          'brightness: 100%',
          'contrast: 100%',
          'saturation: 30%',
          'opacity: 100%',
          'sepia: 10%'
        ]
      }).addTo(map);

      // Esri World Imagery, lightened
      L.tileLayer.colorFilter('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
        minZoom: 19,
        maxZoom: 19,
        attribution: '<a href="https://www.arcgis.com/home/item.html?id=10df2279f9684e4a9f6a7f08febac2a9">Esri</a>',
        filter: [
          'brightness: 100%',
          'contrast: 100%',
          'saturation: 100%',
          'opacity: 70%',
          'sepia: 0%'
        ]
      }).addTo(map);

/*
      // Stamen Toner labels
      L.tileLayer.colorFilter('https://stamen-tiles-{s}.a.ssl.fastly.net/toner-labels/{z}/{x}/{y}{r}.png', {
        minZoom: 12,
        maxZoom: 19,
        attribution: '<a href="http://maps.stamen.com/toner-labels/">Stamen</a>',
        filter: [
          'brightness: 100%',
          'contrast: 100%',
          'saturation: 100%',
          'opacity: 70%',
          'sepia: 0%',
          'invert: 100%'
        ]
      }).addTo(map);
*/

      <!-- add marker for each garden relevant to the current page -->
      markers = [];
      bounds = L.latLngBounds();
      var div_circle = L.divIcon({ className: 'dot' });
      {{ $points := slice . }}
      {{ if eq (replaceRE "\\\\" "/" .Dir ) "/" }}
        {{ $points = .Site.RegularPages }}
      {{ else }}
        {{ with .RegularPagesRecursive }}
            {{ $points = . }}
        {{ end }}
      {{ end }}
      {{- range $points }}
        {{ if .Params.latlon }}
          {{ $lat := index .Params.latlon 0 }}
          {{ $lon := index .Params.latlon 1 }}
          {{ if gt $lat 0 }}
            marker = L.marker([ {{ $lat }}, {{ $lon }} ], { icon: div_circle });
            marker.bindPopup("<a href='{{ .Permalink }}'>{{ .Title }}</a>");
            marker.addTo(map);
            markers.push(marker);
            bounds.extend(marker.getLatLng());
          {{ end }}
        {{ end }}
      {{- end }}
      if (bounds.isValid()) {
        map.fitBounds(bounds.pad(0.05));
        if (map.getZoom() > 17) {
          map.setZoom(17);
        }
      }
    </script>
  </div>
</div>
