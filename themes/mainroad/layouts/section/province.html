{{ define "main" }}
<main class="main list" role="main">
  <!-- current path with proper slashes -->
  {{ $path := print (path.Dir .Path) }}

  <!-- province name hierarchy, properly capitalized etc. -->
  {{ $province := replaceRE "province.(.*?)" "$1" $path }}
  {{ $province = replaceRE "_" " " $province | upper }}
  {{ $province = replaceRE "/" ": " $province }}


  <header class="main__header">
    <h1 class="main__title">{{ $province }}</h1>
  </header>

  <!-- iterate through all published pages in this province
       to find unique subdirectories
  -->
  {{ $dirs := slice }}
  {{ range .RegularPagesRecursive }}
    {{ $d := strings.TrimPrefix (print $path "/") (path.Dir .Dir) }}
    <!-- only keep first level subdirectories -->
    {{ $d = replaceRE "/.*" "" $d }}
    <!-- don't keep articles in the current directory -->
    {{ if and (not (in $dirs $d)) (not (eq $path $d)) }}
      {{ if ne $d "province" }}
        {{ $dirs = $dirs | append $d }}
      {{ end }}
    {{ end }}
  {{ end }}

  <!-- display any subdirectories -->
  {{ if len $dirs }}
  <div class='province-subdivisions'>
    <b>Province subdivisions:</b>
    {{ range $i, $v := sort $dirs -}}
      {{- if $i -}}, {{ end -}}
      {{ with strings.TrimPrefix $path . }}
      {{ $text := replaceRE "_" " " . | title }}
      <a href="{{ . | lower }}/">{{ $text }}</a>
      {{- end -}}
    {{ end }}
  </div>
  {{ end }}

  {{- if .Sections -}}
    {{- range sort .RegularPagesRecursive ".Params.Title" }}
      {{- .Render "summary" }}
    {{- end -}}
  {{- end -}}
</main>
{{ partial "pagination.html" . }}
{{ end }}
